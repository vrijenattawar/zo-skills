---
name: build-close
description: |
  Post-build synthesis for Pulse builds. Aggregates all deposits, synthesizes
  decisions and learnings, extracts positions, generates build AAR.
  Replaces N per-worker closes with 1 build-level close.
  For normal threads use thread-close. For Pulse workers use drop-close.
---

# Build Close

Post-build synthesis for Pulse orchestrated builds.

## When to Use

- After `pulse finalize <slug>` completes
- When all Drops have deposited
- To generate build-level synthesis

**Wrong tool?**
- If normal thread â†’ use `thread-close`
- If you're a Pulse Drop â†’ use `drop-close`

## Quick Start

```bash
# Close a completed build
python3 Skills/build-close/scripts/close.py --slug my-build

# Dry run (preview only)
python3 Skills/build-close/scripts/close.py --slug my-build --dry-run
```

## What It Does

1. **Validates build** â€” Must exist and be terminal (complete/partial/failed)
2. **Loads all deposits** from `N5/builds/<slug>/deposits/`
3. **Generates title** â€” 3-slot emoji system for orchestrator thread
4. **Aggregates decisions** â€” All decisions with rationale across Drops
5. **Aggregates learnings** â€” Key insights from all workers
6. **Aggregates concerns** â€” Issues raised by workers
7. **Extracts positions** â€” Belief candidates from aggregate context
8. **Scans content library** â€” Reusable artifacts from build
9. **Generates BUILD_CLOSE.md** â€” Human-readable synthesis
10. **Generates BUILD_AAR.md** â€” Comprehensive after-action report
11. **Generates Pedagogical Review** (learning_mode builds) â€” Aggregates `concepts_exercised` from all deposits, cross-references `N5/config/understanding_bank.json`, proposes level updates, generates application questions
12. **Updates Understanding Bank** (learning_mode builds) â€” Writes level changes to `N5/config/understanding_bank.json` based on build evidence

## Title Generation (REQUIRED)

After the script outputs aggregated context, you MUST generate a title for the **orchestrator thread** using the 3-slot emoji system.

### Format
```
MMM DD | {state} {type} {content} Build Title
```

### For Build Orchestrators:
- **Slot 1 (State):** Based on build outcome
  - `âœ…` â€” All drops complete, no major concerns
  - `â¸ï¸` â€” Partial completion, work remaining
  - `âŒ` â€” Build failed or blocked
- **Slot 2 (Type):** Always `ğŸ™` (orchestrator)
- **Slot 3 (Content):** `ğŸ—ï¸` (build) unless build was primarily something else
- **NO brackets** â€” Orchestrator threads ARE the parent, don't bracket themselves

### Example Titles
```
Jan 24 | âœ… ğŸ™ ğŸ—ï¸ Pulse System Validation Build
Jan 24 | âœ… ğŸ™ ğŸ—ï¸ Close Skills Refactor
Jan 24 | â¸ï¸ ğŸ™ ğŸ—ï¸ API Integration (3/5 drops complete)
Jan 24 | âŒ ğŸ™ ğŸ—ï¸ Auth System Build (blocked on credentials)
```

### Title Generation Steps
1. Load build meta.json for the build title
2. Assess build outcome from deposits:
   - All complete with no concerns â†’ âœ…
   - Partial or concerns noted â†’ â¸ï¸
   - Failed/blocked â†’ âŒ
3. Use ğŸ™ for type (always orchestrator)
4. Use ğŸ—ï¸ for content (standard for builds)
5. Use the build's title as the semantic portion
6. Add parenthetical if partial/failed explaining why

### Emoji Quick Reference

| Slot | Emoji | Meaning |
|------|-------|---------|
| State | âœ… | Complete, successful |
| State | â¸ï¸ | Partial, work remaining |
| State | âŒ | Failed/blocked |
| Type | ğŸ™ | Orchestrator (always for build-close) |
| Content | ğŸ—ï¸ | Build (default) |
| Content | ğŸ› ï¸ | Repair-focused build |
| Content | ğŸ” | Research-focused build |

## Options

- `--slug` (required): Build slug
- `--dry-run`: Preview without writing files
- `--force`: Bypass guards (use if build not in terminal state)
- `--skip-positions`: Skip position extraction

## Output Files

After running, you'll find:

```
N5/builds/<slug>/
â”œâ”€â”€ BUILD_CLOSE.md    # Human-readable synthesis
â”œâ”€â”€ BUILD_AAR.md      # After-action report
â””â”€â”€ deposits/         # (unchanged)
```

## BUILD_CLOSE.md Format

```markdown
# Build Close: my-build

## Summary

Synthesized 7 deposits.

## Decisions (12)

- Chose async over threads: Better for I/O-bound operations
- Used SQLite over Postgres: Simpler deployment for V1
...

## Learnings

- [D1.1] The API requires auth even for public endpoints
- [D2.1] Rate limiting kicks in after 100 req/min
...

## Concerns

- [D1.2] Error handling is incomplete for edge cases
- [D2.3] No tests for the new auth flow
...

## Position Candidates (3)

- [D1.1] "Simple beats clever in production systems" â€” multiple drops reinforced this
...

## Content Library Candidates (2)

- Artifact: auth-flow-diagram.md
...
```

## BUILD_AAR.md Pedagogical Review Section

When a build has `build_mode: "learning"` in its meta.json, append this section to BUILD_AAR.md after the standard AAR content:

```markdown
## Pedagogical Review

<!-- Generated by aggregating concepts_exercised across all deposits -->

### Concepts Engaged
<!-- Deduplicated list of concepts_exercised from all deposits -->
| Concept | Drops That Exercised It | Previous Level | Demonstrated Level |
|---------|------------------------|----------------|-------------------|
| <concept> | D1.1, D1.3 | learning | familiar |

### Decisions Made by V
<!-- Aggregated from DECISIONS.md in the build folder -->
| Decision | V's Choice | Reasoning | Concepts |
|----------|-----------|-----------|----------|
| <question> | <choice> | <reasoning> | <concepts> |

### Understanding Bank Updates
<!-- Proposed level changes based on build evidence -->
| Concept | Before | After | Evidence |
|---------|--------|-------|----------|
| <concept> | learning | familiar | Engaged in DP-1, discussed tradeoffs |

**Action:** Update `N5/config/understanding_bank.json` with these level changes.

### Application Questions
<!-- 3 Socratic questions testing whether V can apply what was learned -->
1. <Question testing conceptual understanding in a new context>
2. <Question testing ability to evaluate tradeoffs>
3. <Question connecting build concepts to V's broader technical growth>

### Next Learning Frontier
<!-- Based on this build, what should V tackle next? -->
- <Concept that appeared but wasn't deeply explored>
- <Adjacent concept that would deepen understanding>
```

### Pedagogical Review Generation Steps

1. Load all deposits from `N5/builds/<slug>/deposits/`
2. Collect all `concepts_exercised` arrays; deduplicate
3. For each concept, look up current level in `N5/config/understanding_bank.json`
4. Assess demonstrated level based on how the concept was engaged (used vs discussed vs decided upon)
5. Aggregate decisions from `DECISIONS.md` (if present) with concept tags
6. Propose level changes where evidence supports advancement
7. Generate 3 application questions that test transfer, not recall
8. Identify next learning frontier from concepts that appeared but weren't deeply exercised

## Integration with Pulse

Call after Pulse finalization:

```bash
# Standard flow
python3 Skills/pulse/scripts/pulse.py finalize my-build
python3 Skills/build-close/scripts/close.py --slug my-build
```

Or integrate into Pulse finalize step.

## Fail-Safes

This skill includes context guards:

```
âš ï¸  WRONG SKILL DETECTED

You called: build-close
Suggested:  drop-close
Reason:     Build not in terminal state (status: active)

Run the suggested skill instead, or use --force to override.
```

## Checklist Before Completing

- [ ] Title generated with all 3 emoji slots
- [ ] Title uses ğŸ™ for orchestrator type
- [ ] Title does NOT have brackets (orchestrator is the parent)
- [ ] BUILD_CLOSE.md written
- [ ] BUILD_AAR.md written (if warranted)
- [ ] All deposits reviewed and synthesized
- [ ] Position candidates extracted (if any)
- [ ] Content library candidates noted (if any)
- [ ] Pedagogical Review generated (if build_mode is "learning")
- [ ] Understanding bank updates proposed (if learning_mode)

## Related

- `file 'N5/config/emoji-legend.json'` â€” Full emoji definitions
- `file 'N5/lib/close/emoji.py'` â€” Title generation helpers
- `file 'Skills/thread-close/SKILL.md'` â€” Normal thread close
- `file 'Skills/drop-close/SKILL.md'` â€” Drop worker close
